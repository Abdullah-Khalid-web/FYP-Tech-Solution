<div class="container-fluid mt-3">
    <div class="card shadow-sm">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h5 class="mb-0">All Bills</h5>
            <a href="/bills" class="btn btn-sm btn-primary">
                <i class="fas fa-plus me-1"></i> New Bill
            </a>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Bill #</th>
                            <th>Date</th>
                            <th>Customer</th>
                            <th>Items</th>
                            <th>Total</th>
                            <th>Paid</th>
                            <th>Due</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% if (bills && bills.length) { %>
                            <% bills.forEach(bill => { %>
                                <tr>
                                    <td><%= bill.bill_number %></td>
                                    <td><%= new Date(bill.created_at).toLocaleString() %></td>
                                    <td><%= bill.customer_name || 'Walk-in' %></td>
                                    <td><%= bill.item_count %></td>
                                    <td><%= Number(bill.total_amount).toFixed(2) %></td>
                                    <td><%= Number(bill.paid_amount).toFixed(2) %></td>
                                    <td><%= Number(bill.due_amount).toFixed(2) %></td>
                                    <td>
                                        <span class="badge <%= 
                                            bill.due_amount <= 0 ? 'bg-success' : 
                                            bill.paid_amount > 0 ? 'bg-warning' : 'bg-danger' 
                                        %>">
                                            <%= bill.due_amount <= 0 ? 'Paid' : 
                                                bill.paid_amount > 0 ? 'Partial' : 'Unpaid' %>
                                        </span>
                                    </td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <a href="/bills/<%= bill.id %>" class="btn btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                            <a href="/bills/<%= bill.id %>/print" class="btn btn-outline-secondary">
                                                <i class="fas fa-print"></i>
                                            </a>
                                            <button class="btn btn-outline-danger delete-bill" data-id="<%= bill.id %>">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            <% }); %>
                        <% } else { %>
                            <tr>
                                <td colspan="9" class="text-center py-4 text-muted">
                                    No bills found
                                </td>
                            </tr>
                        <% } %>
                    </tbody>
                </table>
            </div>
            
            <!-- Pagination -->
            <% if (totalPages > 1) { %>
                <nav class="px-3 py-2">
                    <ul class="pagination pagination-sm justify-content-end mb-0">
                        <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                            <a class="page-link" href="?page=<%= currentPage - 1 %>">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                        <% for (let i = 1; i <= totalPages; i++) { %>
                            <li class="page-item <%= currentPage === i ? 'active' : '' %>">
                                <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                            </li>
                        <% } %>
                        <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                            <a class="page-link" href="?page=<%= currentPage + 1 %>">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            <% } %>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Delete bill handler
    document.querySelectorAll('.delete-bill').forEach(button => {
        button.addEventListener('click', function() {
            const billId = this.dataset.id;
            if (confirm('Are you sure you want to delete this bill?')) {
                fetch(`/bills/${billId}`, {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        this.closest('tr').remove();
                    } else {
                        alert('Error deleting bill');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Error deleting bill');
                });
            }
        });
    });
});
</script>